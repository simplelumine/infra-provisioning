---
- name: Ensure sudo group exists
  group:
    name: sudo
    state: present

- name: Create user simplelumine
  user:
    name: simplelumine
    groups: sudo
    shell: /bin/bash
    append: true
    create_home: true

- name: Set authorized key for simplelumine
  authorized_key:
    user: simplelumine
    state: present
    # Assuming the key file is on your local machine as defined in your SSH config
    key: "{{ lookup('file', lookup('env', 'USERPROFILE') + '/.ssh/id_ed25519_simplelumine.pub') }}"
  ignore_errors: true # Ignore if local key file is missing during dry-run

- name: Allow passwordless sudo for simplelumine
  lineinfile:
    path: /etc/sudoers.d/simplelumine
    line: 'simplelumine ALL=(ALL) NOPASSWD: ALL'
    state: present
    create: true
    mode: '0440'
    validate: 'visudo -cf %s'
